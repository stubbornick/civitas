<project name="civitas-config" basedir=".">
    <description>
    Civitas Ant build file for configuration properties.
	Do not edit this file; set properties by environment variables
	or by copying config.properties to config.properties.local and
	editing the .local file.
  </description>


  <dirname property="civitas-config.basedir" file="${ant.file.civitas-config}"/>

    <!-- ****************************************
        Configuration properties.
        Load them from config.properties.local, and then use defaults.
       ****************************************  -->
      <property file="${civitas-config.basedir}/config.properties.local"/>

    <!-- set the prefix for accessing environment variables -->
    <property environment="env" />

    <!-- JifE installation -->
    <!-- If it is not defined in the properties file, use the environment variable $JIFE. -->
<!--    <condition property="jife.home" value="${env.JIFE}">
        <and>
            <isset property="env.JIFE" />
            <not>
                <isset property="jife.home" />
            </not>
        </and>
    </condition>

    <condition property="jifec" value="${jife.home}/bin/jifec">
        <and>
	        <isset property="jife.home" />
            <not>
                <isset property="jifec" />
            </not>
        </and>
    </condition>
-->
    <condition property="jifec" value="${civitas-config.basedir}/bin/jifec">
        <not>
            <isset property="jifec" />
        </not>
    </condition>
    <condition property="civitasrun" value="${civitas-config.basedir}/bin/civitasrun">
        <not>
            <isset property="civitasrun" />
        </not>
    </condition>


    <!-- directory for shared libraries -->
    <property name="civitas.lib" location="${civitas-config.basedir}/lib" />

    <!-- directory for class file targets -->
    <property name="civitas.classes" location="${civitas-config.basedir}/classes" />

	<!-- establish the os -->
    <condition property="os.isWindows">
        <os family="windows" />
    </condition>
    <condition property="os.isUnix">
        <os family="unix" />
    </condition>
    <condition property="os.unsupported-os">
        <and>
            <not>
                <os family="windows" />
            </not>
            <not>
                <os family="unix" />
            </not>
        </and>
    </condition>

    <!-- the civitas classpath -->
    <path id="civitas.classpath">
        <pathelement location="${civitas.classes}" />
        <fileset dir="${civitas-config.basedir}/lib">
            <include name="*.jar" />
            <exclude name="*sig*.jar" />
        </fileset>
        <!-- <pathelement path="${java.class.path}" /> -->
    </path>


    <!-- ****************************************
       Configuration targets
       ****************************************  -->
    <target name="configure"
            description="Configures Civitas"
            depends="check-classpath"
            unless="configure.up-to-date">
        <echo message="Java version is ${java.version}" />
        <echo message="Current directory is ${user.dir}" />
        <echo message="Ant base directory is ${basedir}" />
        <echo message="Java home directory is ${java.home}" />
        <echo message="jifec is ${jifec}" />
        <echo message="civitasrun is ${civitasrun}" />
        <property name="configure.up-to-date" value="true" />

    	<chmod dir="${civitas-config.basedir}/bin" perm="a+x" includes="*"/>
    	<chmod dir="${civitas-config.basedir}/experiments/src" perm="a+x"
    	       includes="*.pl"/>
    </target>

    <target name="check-classpath"
            description="Check the classpath has the appropriate directories/jars">
        <available file="${jifec}" property="jifec.available" />

        <fail unless="jifec.available"
              message="The jifec executable was not found at location ${jifec}." />
    </target>

</project>

